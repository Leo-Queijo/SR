<!doctype html> 
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CRM Hospitalar 360¬∫ ‚Äî Agenda M√©dica</title>

<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  darkMode:'class',
  theme:{
    extend:{
      colors:{
        brand_blue:'#005BFF',
        brand_orange:'#FF6B00'
      },
      borderRadius:{card:'12px'}
    }
  }
}
</script>

<style>
::-webkit-scrollbar{width:8px}
::-webkit-scrollbar-thumb{background:#94a3b8;border-radius:6px}
</style>
</head>

<body class="bg-gray-100 dark:bg-slate-900 dark:text-slate-100">
<div class="flex min-h-screen">

<!-- SIDEBAR -->
<aside class="hidden md:flex w-64 bg-white dark:bg-slate-800 shadow-xl p-6 flex-col gap-6">
  <div class="flex items-center gap-3">
    <div class="h-12 w-12 rounded-xl bg-brand_blue text-white flex items-center justify-center font-bold">SR</div>
    <div>
      <h1 class="font-bold">CRM S√£o Rafael</h1>
      <p class="text-xs text-gray-500">Agenda M√©dica</p>
    </div>
  </div>
  <nav class="flex flex-col gap-2 flex-1">
    <a href="./index.html" class="px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">Menu</a>
    <a href="./Alertas.html" class="px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">Alertas</a>
    <a href="./preditivo.html" class="px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">IA Pacientes</a>
    <a href="./lead.html" class="px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700">Leads</a>
    <a href="./agenda.html" class="px-4 py-2 rounded-lg bg-brand_blue text-white font-medium">Agendas</a>
  </nav>
</aside>

<!-- CONTE√öDO -->
<main class="flex-1 p-8 space-y-6">

<h1 class="text-2xl font-bold">Agenda M√©dica</h1>

<!-- M√âDICO -->
<section class="bg-white dark:bg-slate-800 p-5 rounded-card shadow">
<h2 class="text-xs text-gray-500 mb-2">1Ô∏è‚É£ M√©dico</h2>
<select id="doctorSelect" class="w-full p-3 border rounded-lg">
  <option>Dr. Jo√£o Silva ‚Äî Cardiologia</option>
  <option>Dra. Marina Costa ‚Äî Dermatologia</option>
  <option>Dr. Felipe Andrade ‚Äî Ortopedia</option>
</select>
</section>

<!-- PACIENTE -->
<section class="bg-white dark:bg-slate-800 p-5 rounded-card shadow">
<h2 class="text-xs text-gray-500 mb-2">2Ô∏è‚É£ Paciente</h2>
<div class="grid gap-3">
<input id="pacienteNome" class="p-3 border rounded-lg" placeholder="Nome do paciente">
<input id="pacienteTelefone" class="p-3 border rounded-lg" placeholder="WhatsApp (DDD + n√∫mero)">
</div>
</section>

<!-- CALEND√ÅRIO + HOR√ÅRIOS -->
<div class="grid md:grid-cols-2 gap-6">

<section class="bg-white dark:bg-slate-800 p-5 rounded-card shadow">
<div class="flex justify-between items-center mb-3">
<button onclick="changeMonth(-1)">‚óÄ</button>
<h2 id="monthLabel" class="font-semibold"></h2>
<button onclick="changeMonth(1)">‚ñ∂</button>
</div>

<!-- DIAS DA SEMANA -->
<div class="grid grid-cols-7 text-center text-xs font-semibold text-gray-500 mb-2">
  <div>Seg</div>
  <div>Ter</div>
  <div>Qua</div>
  <div>Qui</div>
  <div>Sex</div>
  <div>S√°b</div>
  <div>Dom</div>
</div>

<div id="calendar" class="grid grid-cols-7 gap-2"></div>
</section>

<section class="bg-white dark:bg-slate-800 p-5 rounded-card shadow">
<h2 class="font-semibold mb-2">Hor√°rios</h2>
<p id="selectedDate" class="text-sm text-gray-500 mb-2"></p>
<div id="timeSlots" class="grid grid-cols-2 gap-2"></div>
</section>

</div>

</main>
</div>

<script>
const calendar=document.getElementById("calendar");
const monthLabel=document.getElementById("monthLabel");
const timeSlotsEl=document.getElementById("timeSlots");
const selectedDateEl=document.getElementById("selectedDate");

let current=new Date(), selectedKey=null;

const horarios=[
"08:00","08:30","09:00","09:30",
"10:00","10:30","14:00","14:30",
"15:00","15:30","16:00"
];

const load=()=>JSON.parse(localStorage.getItem("agenda")||"{}");
const save=d=>localStorage.setItem("agenda",JSON.stringify(d));

function renderCalendar(){
calendar.innerHTML="";
const y=current.getFullYear(),m=current.getMonth();
monthLabel.textContent=current.toLocaleString("pt-BR",{month:"long",year:"numeric"});

// üîß AJUSTE: semana come√ßa na segunda
let first=new Date(y,m,1).getDay();
first = first === 0 ? 6 : first - 1;

const last=new Date(y,m+1,0).getDate();

for(let i=0;i<first;i++){
  calendar.appendChild(document.createElement("div"));
}

for(let d=1;d<=last;d++){
const el=document.createElement("div");
el.textContent=d;
el.className="p-2 border rounded text-center cursor-pointer hover:bg-blue-100";
el.onclick=()=>loadDay(d,m,y);
calendar.appendChild(el);
}
}

function changeMonth(n){
current.setMonth(current.getMonth()+n);
renderCalendar();
}

function loadDay(d,m,y){
const date=new Date(y,m,d);
selectedKey=date.toISOString().split("T")[0];
selectedDateEl.textContent=date.toLocaleDateString("pt-BR");
timeSlotsEl.innerHTML="";
const data=load()[selectedKey]||{};

horarios.forEach(h=>{
const btn=document.createElement("button");
const slot=data[h];
btn.className="p-2 rounded-lg border text-sm font-medium w-full";

if(slot){
btn.disabled=true;
btn.classList.add(
slot.status==="confirmado"?"bg-green-200":
slot.status==="atendente"?"bg-yellow-200":"bg-gray-200"
);
btn.innerHTML=`${h}<span class="block text-xs">${slot.status}</span>`;
}else{
btn.classList.add("bg-green-50","hover:bg-green-100");
btn.textContent=h;
btn.onclick=()=>agendar(h);
}

timeSlotsEl.appendChild(btn);
});
}

function agendar(h){
const nome=pacienteNome.value.trim();
const tel=pacienteTelefone.value.trim();
if(!nome||!tel)return alert("Preencha os dados");

const data=load();
if(!data[selectedKey])data[selectedKey]={};

data[selectedKey][h]={
nome,
tel,
medico:doctorSelect.value,
status:"pendente"
};

save(data);
enviarWhatsApp(nome,tel,h);
loadDay(new Date(selectedKey).getDate(),current.getMonth(),current.getFullYear());
alert("üîî Agendamento criado (pendente)");
}

function enviarWhatsApp(nome,tel,h){
const msg=encodeURIComponent(
`Ol√° ${nome} üëã
Consulta agendada:

üìÖ ${selectedKey}
‚è∞ ${h}

Responda:
1Ô∏è‚É£ Confirmar
2Ô∏è‚É£ Desmarcar
3Ô∏è‚É£ Falar com atendente`
);
window.open(`https://api.whatsapp.com/send?phone=55${tel}&text=${msg}`,"_blank");
}

// ‚å®Ô∏è ATALHOS
document.addEventListener("keydown",e=>{
if(!selectedKey)return;
const data=load();
const slot=Object.values(data[selectedKey]||{})[0];
if(!slot)return;

if(e.key==="1"){slot.status="confirmado";alert("‚úî Consulta confirmada");}
if(e.key==="2"){delete data[selectedKey];alert("‚ùå Consulta desmarcada");}
if(e.key==="3"){slot.status="atendente";alert("üßë‚Äçüíº Encaminhado ao atendente");}

save(data);
loadDay(new Date(selectedKey).getDate(),current.getMonth(),current.getFullYear());
});

renderCalendar();
</script>

</body>
</html>
